local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local player = game.Players.LocalPlayer

-- Variables
local addedObjects = {}
local selectedObject = nil
local currentMode = "Select"
local currentEasingStyle = Enum.EasingStyle.Linear
local keyframes = {}
local moveSpheres = {}
local resizeSpheres = {}
local isPlaying = false
local activeButton = nil
local activeSmoothsButton = nil
local smoothsExpanded = false

-- UI Creation
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ObjectEditor"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 400, 0, 60)
mainFrame.Position = UDim2.new(0.5, -200, 0, 20)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 25)
titleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 8)
titleCorner.Parent = titleBar

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -10, 1, 0)
titleLabel.Position = UDim2.new(0, 10, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Object Editor"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextSize = 14
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = titleBar

local contentFrame = Instance.new("Frame")
contentFrame.Name = "ContentFrame"
contentFrame.Size = UDim2.new(1, -10, 1, -30)
contentFrame.Position = UDim2.new(0, 5, 0, 27)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

local buttonContainer = Instance.new("Frame")
buttonContainer.Name = "ButtonContainer"
buttonContainer.Size = UDim2.new(1, 0, 0, 28)
buttonContainer.BackgroundTransparency = 1
buttonContainer.Parent = contentFrame

local buttonLayout = Instance.new("UIListLayout")
buttonLayout.FillDirection = Enum.FillDirection.Horizontal
buttonLayout.Padding = UDim.new(0, 3)
buttonLayout.SortOrder = Enum.SortOrder.LayoutOrder
buttonLayout.Parent = buttonContainer

-- Color Picker Frame
local colorFrame = Instance.new("Frame")
colorFrame.Name = "ColorFrame"
colorFrame.Size = UDim2.new(0, 250, 0, 200)
colorFrame.Position = UDim2.new(0, 0, 0, 65)
colorFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
colorFrame.BorderSizePixel = 0
colorFrame.Visible = false
colorFrame.Parent = mainFrame

local colorCorner = Instance.new("UICorner")
colorCorner.CornerRadius = UDim.new(0, 8)
colorCorner.Parent = colorFrame

local hueSlider = Instance.new("Frame")
hueSlider.Size = UDim2.new(0.9, 0, 0, 20)
hueSlider.Position = UDim2.new(0.05, 0, 0, 10)
hueSlider.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
hueSlider.BorderSizePixel = 0
hueSlider.Parent = colorFrame

local hueGradient = Instance.new("UIGradient")
hueGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
    ColorSequenceKeypoint.new(0.17, Color3.fromRGB(255, 255, 0)),
    ColorSequenceKeypoint.new(0.33, Color3.fromRGB(0, 255, 0)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)),
    ColorSequenceKeypoint.new(0.67, Color3.fromRGB(0, 0, 255)),
    ColorSequenceKeypoint.new(0.83, Color3.fromRGB(255, 0, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 0))
})
hueGradient.Parent = hueSlider

local saturationBrightness = Instance.new("Frame")
saturationBrightness.Size = UDim2.new(0.9, 0, 0, 120)
saturationBrightness.Position = UDim2.new(0.05, 0, 0, 40)
saturationBrightness.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
saturationBrightness.BorderSizePixel = 0
saturationBrightness.Parent = colorFrame

local satGradient = Instance.new("UIGradient")
satGradient.Color = ColorSequence.new(Color3.fromRGB(255, 255, 255), Color3.fromRGB(255, 0, 0))
satGradient.Parent = saturationBrightness

local brightFrame = Instance.new("Frame")
brightFrame.Size = UDim2.new(1, 0, 1, 0)
brightFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
brightFrame.BackgroundTransparency = 0
brightFrame.BorderSizePixel = 0
brightFrame.Parent = saturationBrightness

local brightGradient = Instance.new("UIGradient")
brightGradient.Transparency = NumberSequence.new({
    NumberSequenceKeypoint.new(0, 0),
    NumberSequenceKeypoint.new(1, 1)
})
brightGradient.Rotation = 90
brightGradient.Parent = brightFrame

local currentHue = 0
local currentSat = 1
local currentBright = 1

local function HSVToRGB(h, s, v)
    local c = v * s
    local x = c * (1 - math.abs((h / 60) % 2 - 1))
    local m = v - c
    local r, g, b
    if h < 60 then r, g, b = c, x, 0
    elseif h < 120 then r, g, b = x, c, 0
    elseif h < 180 then r, g, b = 0, c, x
    elseif h < 240 then r, g, b = 0, x, c
    elseif h < 300 then r, g, b = x, 0, c
    else r, g, b = c, 0, x end
    return Color3.fromRGB((r + m) * 255, (g + m) * 255, (b + m) * 255)
end

hueSlider.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        local function update()
            local mousePos = input.Position.X
            local relativePos = math.clamp((mousePos - hueSlider.AbsolutePosition.X) / hueSlider.AbsoluteSize.X, 0, 1)
            currentHue = relativePos * 360
            local baseColor = HSVToRGB(currentHue, 1, 1)
            saturationBrightness.BackgroundColor3 = baseColor
            satGradient.Color = ColorSequence.new(Color3.fromRGB(255, 255, 255), baseColor)
            if selectedObject then
                selectedObject.Color = HSVToRGB(currentHue, currentSat, currentBright)
            end
        end
        update()
        local connection
        connection = input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                connection:Disconnect()
            end
        end)
    end
end)

saturationBrightness.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        local function update()
            local mouseX = input.Position.X
            local mouseY = input.Position.Y
            local relativeX = math.clamp((mouseX - saturationBrightness.AbsolutePosition.X) / saturationBrightness.AbsoluteSize.X, 0, 1)
            local relativeY = math.clamp((mouseY - saturationBrightness.AbsolutePosition.Y) / saturationBrightness.AbsoluteSize.Y, 0, 1)
            currentSat = relativeX
            currentBright = 1 - relativeY
            if selectedObject then
                selectedObject.Color = HSVToRGB(currentHue, currentSat, currentBright)
            end
        end
        update()
        local connection
        connection = input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                connection:Disconnect()
            end
        end)
    end
end)

-- Material Frame
local materialFrame = Instance.new("ScrollingFrame")
materialFrame.Name = "MaterialFrame"
materialFrame.Size = UDim2.new(0, 200, 0, 150)
materialFrame.Position = UDim2.new(0, 0, 0, 65)
materialFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
materialFrame.BorderSizePixel = 0
materialFrame.Visible = false
materialFrame.ScrollBarThickness = 6
materialFrame.Parent = mainFrame

local matCorner = Instance.new("UICorner")
matCorner.CornerRadius = UDim.new(0, 8)
matCorner.Parent = materialFrame

local matLayout = Instance.new("UIListLayout")
matLayout.Padding = UDim.new(0, 2)
matLayout.SortOrder = Enum.SortOrder.LayoutOrder
matLayout.Parent = materialFrame

local materials = {"Grass", "Cobblestone", "Neon", "Glass", "Sand", "Plastic", "Wood", "Metal", "Concrete", "Brick"}

for i, mat in ipairs(materials) do
    local matButton = Instance.new("TextButton")
    matButton.Size = UDim2.new(1, -10, 0, 25)
    matButton.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    matButton.BorderSizePixel = 0
    matButton.Text = mat
    matButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    matButton.TextSize = 12
    matButton.Font = Enum.Font.Gotham
    matButton.Parent = materialFrame
    
    local matCorner2 = Instance.new("UICorner")
    matCorner2.CornerRadius = UDim.new(0, 4)
    matCorner2.Parent = matButton
    
    matButton.MouseButton1Click:Connect(function()
        if selectedObject then
            selectedObject.Material = Enum.Material[mat]
        end
    end)
end

matLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    materialFrame.CanvasSize = UDim2.new(0, 0, 0, matLayout.AbsoluteContentSize.Y + 5)
end)

-- Keyframe Frame
local keyframeFrame = Instance.new("Frame")
keyframeFrame.Name = "KeyframeFrame"
keyframeFrame.Size = UDim2.new(0, 600, 0, 200)
keyframeFrame.Position = UDim2.new(0, 0, 0, 65)
keyframeFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
keyframeFrame.BorderSizePixel = 0
keyframeFrame.Visible = false
keyframeFrame.Parent = mainFrame

local kfCorner = Instance.new("UICorner")
kfCorner.CornerRadius = UDim.new(0, 8)
kfCorner.Parent = keyframeFrame

local objectListFrame = Instance.new("ScrollingFrame")
objectListFrame.Size = UDim2.new(0, 150, 1, -40)
objectListFrame.Position = UDim2.new(0, 5, 0, 5)
objectListFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
objectListFrame.BorderSizePixel = 0
objectListFrame.ScrollBarThickness = 4
objectListFrame.Parent = keyframeFrame

local objLayout = Instance.new("UIListLayout")
objLayout.Padding = UDim.new(0, 2)
objLayout.SortOrder = Enum.SortOrder.LayoutOrder
objLayout.Parent = objectListFrame

local timelineFrame = Instance.new("ScrollingFrame")
timelineFrame.Size = UDim2.new(1, -165, 1, -40)
timelineFrame.Position = UDim2.new(0, 160, 0, 5)
timelineFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
timelineFrame.BorderSizePixel = 0
timelineFrame.ScrollBarThickness = 4
timelineFrame.CanvasSize = UDim2.new(5, 0, 0, 0)
timelineFrame.Parent = keyframeFrame

local playButton = Instance.new("TextButton")
playButton.Size = UDim2.new(0, 80, 0, 30)
playButton.Position = UDim2.new(0, 5, 1, -35)
playButton.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
playButton.Text = "Play"
playButton.TextColor3 = Color3.fromRGB(255, 255, 255)
playButton.TextSize = 12
playButton.Font = Enum.Font.GothamBold
playButton.Parent = keyframeFrame

local playCorner = Instance.new("UICorner")
playCorner.CornerRadius = UDim.new(0, 4)
playCorner.Parent = playButton

local selectedKFObject = nil

local function updateKeyframeDisplay()
    for _, child in ipairs(objectListFrame:GetChildren()) do
        if child:IsA("Frame") then
            child:Destroy()
        end
    end
    for _, child in ipairs(timelineFrame:GetChildren()) do
        if child:IsA("Frame") then
            child:Destroy()
        end
    end
    
    for i, obj in ipairs(addedObjects) do
        local objFrame = Instance.new("Frame")
        objFrame.Size = UDim2.new(1, -5, 0, 30)
        objFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
        objFrame.BorderSizePixel = 0
        objFrame.Parent = objectListFrame
        
        local objLabel = Instance.new("TextLabel")
        objLabel.Size = UDim2.new(1, -50, 1, 0)
        objLabel.BackgroundTransparency = 1
        objLabel.Text = "Object " .. i
        objLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        objLabel.TextSize = 11
        objLabel.Font = Enum.Font.Gotham
        objLabel.TextXAlignment = Enum.TextXAlignment.Left
        objLabel.Parent = objFrame
        
        local addKFBtn = Instance.new("TextButton")
        addKFBtn.Size = UDim2.new(0, 20, 0, 20)
        addKFBtn.Position = UDim2.new(1, -45, 0.5, -10)
        addKFBtn.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
        addKFBtn.Text = "+"
        addKFBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        addKFBtn.TextSize = 14
        addKFBtn.Font = Enum.Font.GothamBold
        addKFBtn.Parent = objFrame
        
        local removeKFBtn = Instance.new("TextButton")
        removeKFBtn.Size = UDim2.new(0, 20, 0, 20)
        removeKFBtn.Position = UDim2.new(1, -22, 0.5, -10)
        removeKFBtn.BackgroundColor3 = Color3.fromRGB(180, 60, 60)
        removeKFBtn.Text = "-"
        removeKFBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        removeKFBtn.TextSize = 14
        removeKFBtn.Font = Enum.Font.GothamBold
        removeKFBtn.Parent = objFrame
        
        local timelineLine = Instance.new("Frame")
        timelineLine.Size = UDim2.new(1, 0, 0, 30)
        timelineLine.Position = UDim2.new(0, 0, 0, (i - 1) * 32)
        timelineLine.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
        timelineLine.BorderSizePixel = 0
        timelineLine.Parent = timelineFrame
        
        local separator = Instance.new("Frame")
        separator.Size = UDim2.new(1, 0, 0, 1)
        separator.Position = UDim2.new(0, 0, 1, 0)
        separator.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
        separator.BorderSizePixel = 0
        separator.Parent = timelineLine
        
        if not keyframes[obj] then
            keyframes[obj] = {}
        end
        
        for time, kfData in pairs(keyframes[obj]) do
            local kfMarker = Instance.new("Frame")
            kfMarker.Size = UDim2.new(0, 10, 0, 10)
            kfMarker.Position = UDim2.new(time / 10, -5, 0.5, -5)
            kfMarker.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
            kfMarker.BorderSizePixel = 0
            kfMarker.Parent = timelineLine
            
            local kfCorner3 = Instance.new("UICorner")
            kfCorner3.CornerRadius = UDim.new(1, 0)
            kfCorner3.Parent = kfMarker
        end
        
        objFrame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                selectedKFObject = obj
            end
        end)
        
        addKFBtn.MouseButton1Click:Connect(function()
            if selectedKFObject == obj then
                local currentTime = tick() % 10
                keyframes[obj][currentTime] = {
                    Position = obj.Position,
                    Size = obj.Size,
                    Color = obj.Color,
                    Material = obj.Material
                }
                updateKeyframeDisplay()
            end
        end)
        
        removeKFBtn.MouseButton1Click:Connect(function()
            if selectedKFObject == obj and keyframes[obj] then
                local closestTime = nil
                local minDist = math.huge
                local currentTime = tick() % 10
                for time, _ in pairs(keyframes[obj]) do
                    local dist = math.abs(time - currentTime)
                    if dist < minDist then
                        minDist = dist
                        closestTime = time
                    end
                end
                if closestTime then
                    keyframes[obj][closestTime] = nil
                    updateKeyframeDisplay()
                end
            end
        end)
    end
    
    objLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        objectListFrame.CanvasSize = UDim2.new(0, 0, 0, objLayout.AbsoluteContentSize.Y + 5)
    end)
end

playButton.MouseButton1Click:Connect(function()
    isPlaying = not isPlaying
    playButton.Text = isPlaying and "Stop" or "Play"
    
    if isPlaying then
        for obj, kfs in pairs(keyframes) do
            local sortedTimes = {}
            for time, _ in pairs(kfs) do
                table.insert(sortedTimes, time)
            end
            table.sort(sortedTimes)
            
            for i = 1, #sortedTimes - 1 do
                local startTime = sortedTimes[i]
                local endTime = sortedTimes[i + 1]
                local duration = endTime - startTime
                
                local tweenInfo = TweenInfo.new(duration, currentEasingStyle, Enum.EasingDirection.InOut)
                local tween = TweenService:Create(obj, tweenInfo, {
                    Position = kfs[endTime].Position,
                    Size = kfs[endTime].Size,
                    Color = kfs[endTime].Color
                })
                
                task.wait(startTime)
                tween:Play()
                tween.Completed:Wait()
            end
        end
        isPlaying = false
        playButton.Text = "Play"
    end
end)

-- Sphere functions
local function clearSpheres()
    for _, sphere in ipairs(moveSpheres) do
        sphere:Destroy()
    end
    for _, sphere in ipairs(resizeSpheres) do
        sphere:Destroy()
    end
    moveSpheres = {}
    resizeSpheres = {}
end

local function createMoveSpheres(obj)
    clearSpheres()
    local positions = {
        Vector3.new(1, 0, 0), Vector3.new(-1, 0, 0),
        Vector3.new(0, 1, 0), Vector3.new(0, -1, 0),
        Vector3.new(0, 0, 1), Vector3.new(0, 0, -1)
    }
    
    for _, offset in ipairs(positions) do
        local sphere = Instance.new("Part")
        sphere.Shape = Enum.PartType.Ball
        sphere.Size = Vector3.new(0.5, 0.5, 0.5)
        sphere.Color = Color3.fromRGB(100, 200, 255)
        sphere.Material = Enum.Material.Neon
        sphere.Anchored = true
        sphere.CanCollide = false
        sphere.Parent = workspace
        
        local function updatePos()
            sphere.Position = obj.Position + (offset * (obj.Size / 2)) + (offset * 0.5)
        end
        updatePos()
        
        table.insert(moveSpheres, sphere)
        
        local clickDetector = Instance.new("ClickDetector")
        clickDetector.Parent = sphere
        
        local dragging = false
        clickDetector.MouseClick:Connect(function()
            dragging = not dragging
            if dragging then
                sphere.Color = Color3.fromRGB(255, 255, 100)
                local connection
                connection = RunService.RenderStepped:Connect(function()
                    if not dragging then
                        connection:Disconnect()
                        sphere.Color = Color3.fromRGB(100, 200, 255)
                        return
                    end
                    local mouse = player:GetMouse()
                    local ray = Ray.new(mouse.UnitRay.Origin, mouse.UnitRay.Direction * 1000)
                    local hit, pos = workspace:FindPartOnRay(ray, player.Character)
                    if offset.X ~= 0 then
                        obj.Position = Vector3.new(pos.X, obj.Position.Y, obj.Position.Z)
                    elseif offset.Y ~= 0 then
                        obj.Position = Vector3.new(obj.Position.X, pos.Y, obj.Position.Z)
                    else
                        obj.Position = Vector3.new(obj.Position.X, obj.Position.Y, pos.Z)
                    end
                    updatePos()
                end)
            end
        end)
        
        RunService.RenderStepped:Connect(updatePos)
    end
end

local function createResizeSpheres(obj)
    clearSpheres()
-- Continue from where you left off (after createResizeSpheres function start)

        local function updatePos()
            sphere.Position = obj.Position + (offset * (obj.Size / 2))
        end
        updatePos()
        
        table.insert(resizeSpheres, sphere)
        
        local clickDetector = Instance.new("ClickDetector")
        clickDetector.Parent = sphere
        
        local dragging = false
        clickDetector.MouseClick:Connect(function()
            dragging = not dragging
            if dragging then
                sphere.Color = Color3.fromRGB(255, 255, 100)
                local startPos = obj.Position
                local startSize = obj.Size
                local connection
                connection = RunService.RenderStepped:Connect(function()
                    if not dragging then
                        connection:Disconnect()
                        sphere.Color = Color3.fromRGB(255, 150, 100)
                        return
                    end
                    local mouse = player:GetMouse()
                    local ray = Ray.new(mouse.UnitRay.Origin, mouse.UnitRay.Direction * 1000)
                    local hit, pos = workspace:FindPartOnRay(ray, player.Character)
                    local delta = pos - startPos
                    obj.Size = Vector3.new(
                        math.max(1, startSize.X + delta.X * offset.X * 2),
                        math.max(1, startSize.Y + delta.Y * offset.Y * 2),
                        math.max(1, startSize.Z + delta.Z * offset.Z * 2)
                    )
                    updatePos()
                end)
            end
        end)
        
        RunService.RenderStepped:Connect(updatePos)
    end
end

-- Button configuration
local buttonObjects = {}

local mainButtons = {
    {name = "Add", color = Color3.fromRGB(80, 200, 120)},
    {name = "Select", color = Color3.fromRGB(100, 150, 255)},
    {name = "Remove", color = Color3.fromRGB(255, 100, 100)},
    {name = "Move", color = Color3.fromRGB(255, 200, 100)},
    {name = "Resize", color = Color3.fromRGB(200, 100, 255)},
    {name = "Materials", color = Color3.fromRGB(150, 150, 150)},
    {name = "Color", color = Color3.fromRGB(255, 150, 200)},
    {name = "Keyframes", color = Color3.fromRGB(100, 200, 200)},
    {name = "Smooths", color = Color3.fromRGB(200, 200, 100), hasSubmenu = true}
}

local smoothsSubmenu = {
    {name = "Linear", color = Color3.fromRGB(180, 180, 90), style = Enum.EasingStyle.Linear},
    {name = "Elastic", color = Color3.fromRGB(180, 180, 90), style = Enum.EasingStyle.Elastic},
    {name = "Instant", color = Color3.fromRGB(180, 180, 90), style = nil}
}

local function createToggleButton(config, parent, isSubmenu)
    local button = Instance.new("TextButton")
    button.Name = config.name
    button.Size = UDim2.new(0, isSubmenu and 70 or 80, 0, 28)
    button.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    button.BorderSizePixel = 0
    button.Text = config.name
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 11
    button.Font = Enum.Font.GothamBold
    button.Parent = parent
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 4)
    btnCorner.Parent = button
    
    local highlight = Instance.new("Frame")
    highlight.Name = "Highlight"
    highlight.Size = UDim2.new(1, 0, 0, 2)
    highlight.Position = UDim2.new(0, 0, 1, -2)
    highlight.BackgroundColor3 = config.color
    highlight.BorderSizePixel = 0
    highlight.Visible = false
    highlight.Parent = button
    
    return button, highlight
end

-- Create smooths container
local smoothsContainer = Instance.new("Frame")
smoothsContainer.Name = "SmoothsContainer"
smoothsContainer.Size = UDim2.new(1, 0, 0, 0)
smoothsContainer.Position = UDim2.new(0, 0, 0, 31)
smoothsContainer.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
smoothsContainer.BorderSizePixel = 0
smoothsContainer.Visible = false
smoothsContainer.Parent = contentFrame

local smoothCorner = Instance.new("UICorner")
smoothCorner.CornerRadius = UDim.new(0, 4)
smoothCorner.Parent = smoothsContainer

local containerLayout = Instance.new("UIListLayout")
containerLayout.FillDirection = Enum.FillDirection.Horizontal
containerLayout.Padding = UDim.new(0, 3)
containerLayout.SortOrder = Enum.SortOrder.LayoutOrder
containerLayout.Parent = smoothsContainer

-- Create main buttons
for i, config in ipairs(mainButtons) do
    local button, highlight = createToggleButton(config, buttonContainer, false)
    button.LayoutOrder = i
    
    buttonObjects[config.name] = {button = button, highlight = highlight, color = config.color}
    
    -- Create submenu for Smooths
    if config.hasSubmenu then
        containerLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            smoothsContainer.Size = UDim2.new(1, 0, 0, containerLayout.AbsoluteContentSize.Y + 6)
        end)
        
        for j, subConfig in ipairs(smoothsSubmenu) do
            local subButton, subHighlight = createToggleButton(subConfig, smoothsContainer, true)
            subButton.LayoutOrder = j
            
            buttonObjects[subConfig.name] = {button = subButton, highlight = subHighlight, color = subConfig.color, isSubmenu = true}
            
            subButton.MouseButton1Click:Connect(function()
                if activeSmoothsButton and activeSmoothsButton ~= subButton then
                    local prevName = activeSmoothsButton.Name
                    if buttonObjects[prevName] then
                        buttonObjects[prevName].highlight.Visible = false
                        buttonObjects[prevName].button.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
                    end
                end
                
                activeSmoothsButton = subButton
                subHighlight.Visible = true
                subButton.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
                
                if subConfig.style then
                    currentEasingStyle = subConfig.style
                else
                    currentEasingStyle = nil -- Instant
                end
            end)
        end
    end
    
    button.MouseButton1Click:Connect(function()
        if config.hasSubmenu then
            smoothsExpanded = not smoothsExpanded
            smoothsContainer.Visible = smoothsExpanded
        end
        
        if activeButton and activeButton ~= button then
            local prevName = activeButton.Name
            if buttonObjects[prevName] then
                buttonObjects[prevName].highlight.Visible = false
                buttonObjects[prevName].button.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
            end
        end
        
        activeButton = button
        highlight.Visible = true
        button.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
        currentMode = config.name
        
        -- Handle mode changes
        clearSpheres()
        colorFrame.Visible = false
        materialFrame.Visible = false
        keyframeFrame.Visible = false
        
        if config.name == "Add" then
            local part = Instance.new("Part")
            part.Size = Vector3.new(4, 4, 4)
            part.Position = Vector3.new(0, 10, 0)
            part.Anchored = true
            part.Parent = workspace
            table.insert(addedObjects, part)
            selectedObject = part
            updateKeyframeDisplay()
        elseif config.name == "Select" then
            -- Click to select mode
        elseif config.name == "Move" and selectedObject then
            createMoveSpheres(selectedObject)
        elseif config.name == "Resize" and selectedObject then
            createResizeSpheres(selectedObject)
        elseif config.name == "Color" then
            colorFrame.Visible = true
        elseif config.name == "Materials" then
            materialFrame.Visible = true
        elseif config.name == "Keyframes" then
            keyframeFrame.Visible = true
            updateKeyframeDisplay()
        elseif config.name == "Remove" and selectedObject then
            keyframes[selectedObject] = nil
            selectedObject:Destroy()
            local index = table.find(addedObjects, selectedObject)
            if index then
                table.remove(addedObjects, index)
            end
            selectedObject = nil
            clearSpheres()
            updateKeyframeDisplay()
        end
    end)
end

-- Click to select objects
local mouse = player:GetMouse()
mouse.Button1Down:Connect(function()
    if currentMode == "Select" and mouse.Target and table.find(addedObjects, mouse.Target) then
        selectedObject = mouse.Target
        print("Selected:", selectedObject.Name)
    end
end)

-- Dragging functionality for UI
local dragging = false
local dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

titleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

print("Object Editor loaded successfully!")

